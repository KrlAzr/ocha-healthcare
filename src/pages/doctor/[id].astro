---
import Layout from '../../layouts/Layout.astro';
import { User, Building2, MapPin, Calendar, ArrowRight, Globe } from 'lucide-react';

export async function getStaticPaths() {
  const LIVE_DATA_URL = "https://script.google.com/macros/s/AKfycbyvEJvNE4Xi_qtp3vm0GFLjTooG3ES14hXSRlaf0vxm6voCiwKTdEDxH2sYw6mtDPqakw/exec"; 
  const response = await fetch(LIVE_DATA_URL);
  const data = await response.json();
  
  const createId = (name) => {
    return name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
  };

  return data
    .filter(d => d.name && d.name !== "Unknown")
    .map(d => ({
      params: { id: (d.id || createId(d.name)).toString() },
      props: { doctor: d },
    }));
}

const { doctor } = Astro.props;
const cleanLanguage = (l) => l ? l.trim() : "English";
---

<Layout title={`${doctor.name} - Ocha Healthcare`}>
  <div class="pt-32 pb-20 px-4 max-w-5xl mx-auto min-h-screen">
      <a href="/" class="mb-8 flex items-center gap-2 text-slate-500 hover:text-indigo-600 transition font-medium w-fit">
          <ArrowRight className="w-4 h-4 rotate-180" /> Back to Directory
      </a>

      <div class="grid md:grid-cols-3 gap-8 items-start">
          <div class="md:col-span-1">
              <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 text-center sticky top-32">
                  <div class="w-32 h-32 mx-auto rounded-full overflow-hidden mb-4 ring-4 ring-indigo-50 bg-slate-50">
                      <img src={doctor.image} class="w-full h-full object-cover" onError={(e) => e.target.src = "https://placehold.co/300"} />
                  </div>
                  <h1 class="font-serif text-2xl text-slate-900 font-bold mb-1">{doctor.name}</h1>
                  <p class="text-indigo-600 font-medium mb-4">{doctor.specialty}</p>
                  
                  <div class="space-y-3 text-left border-t border-slate-100 pt-4 mb-6">
                      <div class="flex items-start gap-3 text-sm text-slate-600"><Building2 className="w-4 h-4 text-slate-400 mt-0.5 shrink-0" /><span>{doctor.hospital}</span></div>
                      <div class="flex items-start gap-3 text-sm text-slate-600"><MapPin className="w-4 h-4 text-slate-400 mt-0.5 shrink-0" /><span>{doctor.location || "Malaysia"}</span></div>
                  </div>
                  <button class="w-full py-3 bg-indigo-600 text-white font-medium rounded-xl hover:bg-indigo-700 transition shadow-lg shadow-indigo-200 cursor-not-allowed opacity-80" onclick="alert('Booking system coming soon!')">Book Appointment</button>
              </div>
          </div>

          <div class="md:col-span-2 space-y-6">
              <div class="bg-white p-8 rounded-2xl shadow-sm border border-slate-100">
                  <h2 class="font-serif text-xl font-bold text-slate-900 mb-4 flex items-center gap-2"><User className="w-5 h-5 text-indigo-600" /> About Dr. {doctor.name}</h2>
                  <p class="text-slate-600 leading-relaxed mb-6 whitespace-pre-wrap">{doctor.bio || "Biography details are currently being updated by the Ocha Health verification team."}</p>
                  
                   <div class="grid grid-cols-2 gap-4">
                        <div class="bg-indigo-50/50 p-4 rounded-xl border border-indigo-100">
                            <div class="flex items-center gap-2 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">
                                <Globe className="w-3 h-3" /> Languages
                            </div>
                            <div class="font-medium text-slate-800 flex flex-wrap gap-2">
                                {doctor.languages ? doctor.languages.split(',').map(l => (
                                    <span class="bg-white px-2 py-1 rounded-md border border-indigo-100 text-xs shadow-sm text-indigo-900">{cleanLanguage(l)}</span>
                                )) : "English"}
                            </div>
                        </div>
                    </div>
              </div>
          </div>
      </div>
  </div>
</Layout>